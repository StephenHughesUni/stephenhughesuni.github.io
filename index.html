<!DOCTYPE html>
<html>
<head>
    <title>Volcanic Eruptions Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 100vh; } /* Full height of the viewport */
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Fetch the JSON data asynchronously
        fetch('https://stephenhughesuni.github.io/csvjson.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                // Organize data by volcano
                const volcanoEruptions = {};
                data.forEach(function(eruption) {
                    var key = eruption['Volcano Name'];
                    if (!volcanoEruptions[key]) {
                        volcanoEruptions[key] = [];
                    }
                    volcanoEruptions[key].push(eruption);
                });

                // Create markers for each volcano
                for (var volcano in volcanoEruptions) {
                    var eruptions = volcanoEruptions[volcano];
                    eruptions.forEach(function(eruption) {
                        var latLng = eruption.Coordinates.split(', ').map(Number);
                        var marker = L.marker(latLng).addTo(map);
                        var popupContent = createPopupContent(volcano, eruptions);
                        marker.bindPopup(popupContent);
                    });
                }

                function createPopupContent(volcano, eruptions) {
                    // Start the list of years
                    var popupContent = '<b>' + volcano + '</b><br><ul>';
                    eruptions.forEach(function(eruption) {
                        popupContent += '<li><a href="#" onclick="showEruptionDetails(event, \'' +
                                        JSON.stringify(eruption).replace(/"/g, '&quot;') + '\')">' +
                                        eruption.Year + '</a></li>';
                    });
                    popupContent += '</ul>';
                    return popupContent;
                }

                window.showEruptionDetails = function(event, eruptionData) {
                    // Prevent the default link behavior
                    event.preventDefault();

                    // Parse the eruption data
                    var eruption = JSON.parse(eruptionData);

                    // Create content for the detailed information
                    var detailsContent = '<h3>' + eruption['Year'] + ': ' + eruption['Volcano Name'] + '</h3>' +
                                         '<p><b>Location:</b> ' + eruption['Location'] + '</p>' +
                                         '<p><b>Date:</b> ' + eruption['Year'] + '-' +
                                         (eruption['Month'] || 'Unknown') + '-' +
                                         (eruption['Day'] || 'Unknown') + '</p>' +
                                         '<p><b>Volcano Type:</b> ' + eruption['Volcano Type'] + '</p>' +
                                         '<p><b>Status:</b> ' + eruption['Status'] + '</p>' +
                                         '<p><b>Volcanic Explosivity Index:</b> ' + eruption['Volcanic Explosivity Index'] + '</p>' +
                                         '<p><b>Deaths:</b> ' + eruption['Volcano : Deaths'] + ' (' + eruption['Volcano : Deaths Description'] + ')</p>' +
                                         '<p><b>Total Effects:</b> Deaths: ' + eruption['Total Effects : Deaths'] + ' (' + eruption['Total Effects : Deaths Description'] + ')</p>';

                    // Show the details in a popup
                    var latLng = eruption.Coordinates.split(', ').map(Number);
                    L.popup()
                        .setLatLng(latLng)
                        .setContent(detailsContent)
                        .openOn(map);
                };
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
    </script>
</body>
</html>
